name: METRICS_ANOMALY_SCORE
fullyQualifiedName: hktest1.DBT_DB.DBT_SAMPLE_ELEMENTARY.METRICS_ANOMALY_SCORE
tableType: View
columns:
  - name: ID
    dataType: VARCHAR
    dataLength: 16777216
    dataTypeDisplay: text(16777216)
    fullyQualifiedName: hktest1.DBT_DB.DBT_SAMPLE_ELEMENTARY.METRICS_ANOMALY_SCORE.ID
    tags: []
    constraint: "NULL"
    children: []
    customMetrics: []
  - name: FULL_TABLE_NAME
    dataType: VARCHAR
    dataLength: 16777216
    dataTypeDisplay: text(16777216)
    fullyQualifiedName: hktest1.DBT_DB.DBT_SAMPLE_ELEMENTARY.METRICS_ANOMALY_SCORE.FULL_TABLE_NAME
    tags: []
    constraint: "NULL"
    children: []
    customMetrics: []
  - name: COLUMN_NAME
    dataType: VARCHAR
    dataLength: 16777216
    dataTypeDisplay: text(16777216)
    fullyQualifiedName: hktest1.DBT_DB.DBT_SAMPLE_ELEMENTARY.METRICS_ANOMALY_SCORE.COLUMN_NAME
    tags: []
    constraint: "NULL"
    children: []
    customMetrics: []
  - name: DIMENSION
    dataType: VARCHAR
    dataLength: 16777216
    dataTypeDisplay: text(16777216)
    fullyQualifiedName: hktest1.DBT_DB.DBT_SAMPLE_ELEMENTARY.METRICS_ANOMALY_SCORE.DIMENSION
    tags: []
    constraint: "NULL"
    children: []
    customMetrics: []
  - name: DIMENSION_VALUE
    dataType: VARCHAR
    dataLength: 16777216
    dataTypeDisplay: text(16777216)
    fullyQualifiedName: hktest1.DBT_DB.DBT_SAMPLE_ELEMENTARY.METRICS_ANOMALY_SCORE.DIMENSION_VALUE
    tags: []
    constraint: "NULL"
    children: []
    customMetrics: []
  - name: METRIC_NAME
    dataType: VARCHAR
    dataLength: 16777216
    dataTypeDisplay: text(16777216)
    fullyQualifiedName: hktest1.DBT_DB.DBT_SAMPLE_ELEMENTARY.METRICS_ANOMALY_SCORE.METRIC_NAME
    tags: []
    constraint: "NULL"
    children: []
    customMetrics: []
  - name: ANOMALY_SCORE
    dataType: FLOAT
    dataLength: 1
    dataTypeDisplay: float
    fullyQualifiedName: hktest1.DBT_DB.DBT_SAMPLE_ELEMENTARY.METRICS_ANOMALY_SCORE.ANOMALY_SCORE
    tags: []
    constraint: "NULL"
    children: []
    customMetrics: []
  - name: LATEST_METRIC_VALUE
    dataType: FLOAT
    dataLength: 1
    dataTypeDisplay: float
    fullyQualifiedName: hktest1.DBT_DB.DBT_SAMPLE_ELEMENTARY.METRICS_ANOMALY_SCORE.LATEST_METRIC_VALUE
    tags: []
    constraint: "NULL"
    children: []
    customMetrics: []
  - name: BUCKET_START
    dataType: TIMESTAMP
    dataLength: 1
    dataTypeDisplay: timestamp_ntz
    fullyQualifiedName: hktest1.DBT_DB.DBT_SAMPLE_ELEMENTARY.METRICS_ANOMALY_SCORE.BUCKET_START
    tags: []
    constraint: "NULL"
    children: []
    customMetrics: []
  - name: BUCKET_END
    dataType: TIMESTAMP
    dataLength: 1
    dataTypeDisplay: timestamp_ntz
    fullyQualifiedName: hktest1.DBT_DB.DBT_SAMPLE_ELEMENTARY.METRICS_ANOMALY_SCORE.BUCKET_END
    tags: []
    constraint: "NULL"
    children: []
    customMetrics: []
  - name: TRAINING_AVG
    dataType: FLOAT
    dataLength: 1
    dataTypeDisplay: float
    fullyQualifiedName: hktest1.DBT_DB.DBT_SAMPLE_ELEMENTARY.METRICS_ANOMALY_SCORE.TRAINING_AVG
    tags: []
    constraint: "NULL"
    children: []
    customMetrics: []
  - name: TRAINING_STDDEV
    dataType: FLOAT
    dataLength: 1
    dataTypeDisplay: float
    fullyQualifiedName: hktest1.DBT_DB.DBT_SAMPLE_ELEMENTARY.METRICS_ANOMALY_SCORE.TRAINING_STDDEV
    tags: []
    constraint: "NULL"
    children: []
    customMetrics: []
  - name: TRAINING_START
    dataType: TIMESTAMP
    dataLength: 1
    dataTypeDisplay: timestamp_ntz
    fullyQualifiedName: hktest1.DBT_DB.DBT_SAMPLE_ELEMENTARY.METRICS_ANOMALY_SCORE.TRAINING_START
    tags: []
    constraint: "NULL"
    children: []
    customMetrics: []
  - name: TRAINING_END
    dataType: TIMESTAMP
    dataLength: 1
    dataTypeDisplay: timestamp_ntz
    fullyQualifiedName: hktest1.DBT_DB.DBT_SAMPLE_ELEMENTARY.METRICS_ANOMALY_SCORE.TRAINING_END
    tags: []
    constraint: "NULL"
    children: []
    customMetrics: []
  - name: TRAINING_SET_SIZE
    dataType: DECIMAL
    dataLength: 1
    precision: 18
    scale: 0
    dataTypeDisplay: "number(18,0)"
    fullyQualifiedName: hktest1.DBT_DB.DBT_SAMPLE_ELEMENTARY.METRICS_ANOMALY_SCORE.TRAINING_SET_SIZE
    tags: []
    constraint: NOT_NULL
    children: []
    customMetrics: []
  - name: UPDATED_AT
    dataType: TIMESTAMP
    dataLength: 1
    dataTypeDisplay: timestamp_ntz
    fullyQualifiedName: hktest1.DBT_DB.DBT_SAMPLE_ELEMENTARY.METRICS_ANOMALY_SCORE.UPDATED_AT
    tags: []
    constraint: "NULL"
    children: []
    customMetrics: []
  - name: IS_ANOMALY
    dataType: BOOLEAN
    dataLength: 1
    dataTypeDisplay: boolean
    fullyQualifiedName: hktest1.DBT_DB.DBT_SAMPLE_ELEMENTARY.METRICS_ANOMALY_SCORE.IS_ANOMALY
    tags: []
    constraint: "NULL"
    children: []
    customMetrics: []
tableConstraints: []
owners: []
databaseSchema:
  id: 3cbb1476-02db-47d7-82bd-46c3700a3234
  type: databaseSchema
  name: DBT_SAMPLE_ELEMENTARY
  fullyQualifiedName: hktest1.DBT_DB.DBT_SAMPLE_ELEMENTARY
  displayName: DBT_SAMPLE_ELEMENTARY
  deleted: false
database:
  id: 05a8380c-202a-4bf7-861f-bfd7026e8de1
  type: database
  name: DBT_DB
  fullyQualifiedName: hktest1.DBT_DB
  displayName: DBT_DB
  deleted: false
service:
  id: bac8305b-a253-4ae2-9ca8-6009c7ebcdce
  type: databaseService
  name: hktest1
  fullyQualifiedName: hktest1
  description: ""
  displayName: hktest1
  deleted: false
serviceType: Snowflake
schemaDefinition: "create or replace   view dbt_db.DBT_SAMPLE_elementary.metrics_anomaly_score\n\
  \  \n   as (\n    \n\nwith data_monitoring_metrics as (\n\n    select * from dbt_db.DBT_SAMPLE_elementary.data_monitoring_metrics\n\
  \n),\n\ntime_window_aggregation as (\n\n    select\n        id,\n        full_table_name,\n\
  \        column_name,\n        dimension,\n        dimension_value,\n        metric_name,\n\
  \        metric_value,\n        source_value,\n        bucket_start,\n        bucket_end,\n\
  \        bucket_duration_hours,\n        updated_at,\n        avg(metric_value)\
  \ over (partition by metric_name, full_table_name, column_name order by bucket_start\
  \ asc rows between unbounded preceding and current row) as training_avg,\n     \
  \   stddev(cast(metric_value as float)) over (partition by metric_name, full_table_name,\
  \ column_name order by bucket_start asc rows between unbounded preceding and current\
  \ row) as training_stddev,\n        count(metric_value) over (partition by metric_name,\
  \ full_table_name, column_name order by bucket_start asc rows between unbounded\
  \ preceding and current row) as training_set_size,\n        last_value(bucket_end)\
  \ over (partition by metric_name, full_table_name, column_name order by bucket_start\
  \ asc rows between unbounded preceding and current row) training_end,\n        first_value(bucket_end)\
  \ over (partition by metric_name, full_table_name, column_name order by bucket_start\
  \ asc rows between unbounded preceding and current row) as training_start\n    from\
  \ data_monitoring_metrics\n    group by 1,2,3,4,5,6,7,8,9,10,11,12\n),\n\nmetrics_anomaly_score\
  \ as (\n\n    select\n        id,\n        full_table_name,\n        column_name,\n\
  \        dimension,\n        dimension_value,\n        metric_name,\n        case\n\
  \            when training_stddev is null then null\n            when training_stddev\
  \ = 0 then 0\n            else (metric_value - training_avg) / (training_stddev)\n\
  \        end as anomaly_score,\n        metric_value as latest_metric_value,\n \
  \       bucket_start,\n        bucket_end,\n        training_avg,\n        training_stddev,\n\
  \        training_start,\n        training_end,\n        training_set_size,\n  \
  \      max(updated_at) as updated_at\n    from time_window_aggregation\n       \
  \ where\n            metric_value is not null\n            and training_avg is not\
  \ null\n            and bucket_end >= \n    dateadd(day, cast(-7 as integer), cast(date_trunc('day',\
  \ \n  current_timestamp::timestamp\n) as timestamp))\n\n    group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15\n\
  \    order by bucket_end desc\n\n\n),\n\nfinal as (\n\n    select\n        id,\n\
  \        full_table_name,\n        column_name,\n        dimension,\n        dimension_value,\n\
  \        metric_name,\n        anomaly_score,\n        latest_metric_value,\n  \
  \      bucket_start,\n        bucket_end,\n        training_avg,\n        training_stddev,\n\
  \        training_start,\n        training_end,\n        training_set_size,\n  \
  \      updated_at,\n        case\n            when abs(anomaly_score) > 3 then true\n\
  \            else false end\n        as is_anomaly\n    from metrics_anomaly_score\n\
  )\n\nselect * from final\n  );"
tags: []
joins:
  startDate: 2026-01-07
  dayCount: 30
  columnJoins: []
  directTableJoins: []
customMetrics: []
sourceUrl: https://app.snowflake.com/vcgkhnh/ic95276/#/data/databases/DBT_DB/schemas/DBT_SAMPLE_ELEMENTARY/view/METRICS_ANOMALY_SCORE
domains: []
dataProducts: []
sourceHash: fe9f3bc3abf1b57b1db2f2e78c762719
processedLineage: false
entityStatus: Approved
